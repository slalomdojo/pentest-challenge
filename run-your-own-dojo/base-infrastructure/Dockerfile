FROM alpine:3.7

ENV CLOUD_SDK_URL https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-200.0.0-linux-x86_64.tar.gz
ENV TERRAFORM_URL https://releases.hashicorp.com/terraform/0.11.7/terraform_0.11.7_linux_amd64.zip

RUN mkdir /code && \
    apk add --no-cache \
        python-dev \
        musl-dev \
        libffi-dev \
        openssl-dev \
        curl \
        jq \
        py-pip \
        gcc \
        openssh-keygen \
        bash \
        openssh && \
    pip install pyopenssl && \
    curl -sSLo terraform.zip ${TERRAFORM_URL} > /dev/null && \
    unzip terraform.zip -d /bin/

COPY scripts *.tf *.tpl terraform.tfvars /code/

WORKDIR /code
